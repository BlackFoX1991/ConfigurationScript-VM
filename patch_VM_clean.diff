--- VM.cs
+++ VM.cs
@@ -11,6 +11,7 @@
     /// </summary>
     public class VM
     {
+        public bool AllowFileIO { get; set; } = true;
         /// <summary>
         /// Defines the _program
         /// </summary>
@@ -691,6 +692,12 @@
         /// Defines the _stack
         /// </summary>
         private readonly Stack<object> _stack = new();
+        /// <summary>Ensure stack contains at least n items; otherwise throw a VMException.</summary>
+        private void RequireStack(int n, Instruction instr)
+        {
+            if (_stack.Count < n)
+                throw new VMException($"stack underflow: need {n} items, have {_stack.Count}", instr.Line, instr.Col, instr.OriginFile);
+        }
 
         /// <summary>
         /// Defines the _scopes
@@ -1097,6 +1104,7 @@
                     case "fopen":
                         {
                             if (args.Count < 2)
+                            if (!AllowFileIO) throw new VMException("Runtime error: file I/O is disabled (AllowFileIO=false)", instr.Line, instr.Col, instr.OriginFile);
                                 throw new VMException(
                                     "Runtime error: fopen(path, mode) expects 2 arguments",
                                     instr.Line, instr.Col, instr.OriginFile);
@@ -1721,6 +1729,7 @@
                     }
 
                 case OpCode.ROT:
+                        RequireStack(3, instr);
                     {
                         object a = _stack.Pop();
                         object b = _stack.Pop();
@@ -2077,6 +2086,7 @@
                     }
 
                 case OpCode.ADD:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2110,6 +2120,7 @@
                     }
 
                 case OpCode.SUB:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2130,6 +2141,7 @@
                     }
 
                 case OpCode.MUL:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2163,6 +2175,7 @@
                     }
 
                 case OpCode.MOD:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2189,6 +2202,7 @@
                     }
 
                 case OpCode.DIV:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2236,6 +2250,7 @@
                     }
 
                 case OpCode.BIT_AND:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2250,6 +2265,7 @@
                     }
 
                 case OpCode.BIT_OR:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2264,6 +2280,7 @@
                     }
 
                 case OpCode.BIT_XOR:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2308,6 +2325,7 @@
                     }
 
                 case OpCode.EQ:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2323,6 +2341,7 @@
                     }
 
                 case OpCode.NEQ:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop();
                         object l = _stack.Pop();
@@ -2338,6 +2357,7 @@
                     }
 
                 case OpCode.LT:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop(); object l = _stack.Pop();
 
@@ -2366,6 +2386,7 @@
                     }
 
                 case OpCode.GT:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop(); object l = _stack.Pop();
 
@@ -2394,6 +2415,7 @@
                     }
 
                 case OpCode.LE:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop(); object l = _stack.Pop();
 
@@ -2422,6 +2444,7 @@
                     }
 
                 case OpCode.GE:
+                        RequireStack(2, instr);
                     {
                         object r = _stack.Pop(); object l = _stack.Pop();
 